<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–†—É–ª–µ—Ç–∫–∞ –ü—Ä–µ–º–∏—É–º–∞ 2.0</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a0f2a 100%);
      color: #e0e0ff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }

    .container {
      width: 100%;
      max-width: 920px;
      background: rgba(20, 20, 45, 0.92);
      border-radius: 16px;
      border: 1px solid #3a3a6a;
      box-shadow: 0 0 60px rgba(120, 80, 220, 0.25);
      overflow: hidden;
      backdrop-filter: blur(8px);
    }

    .header {
      background: linear-gradient(90deg, #2a1a4a, #4a2a6a);
      padding: 18px 24px;
      text-align: center;
      border-bottom: 2px solid #5a3a8a;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 0 0 10px rgba(180,120,255,0.7);
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding: 24px;
    }

    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
        align-items: stretch;
      }
    }

    .left-panel, .right-panel {
      flex: 1;
      min-width: 0;
    }

    .left-panel {
      background: rgba(15, 15, 35, 0.6);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #3a3a5a;
    }

    .control-group {
      margin-bottom: 22px;
    }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: #c0c0ff;
      font-weight: 500;
    }

    input[type="range"] {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      background: linear-gradient(to right, #4a2a6a 0%, #8a4aff 100%);
      outline: none;
      appearance: none;
      margin-bottom: 8px;
      transition: opacity 0.3s;
    }

    input[type="range"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #a070ff;
      border: 3px solid #e0d0ff;
      box-shadow: 0 0 12px rgba(160,112,255,0.8);
      cursor: pointer;
    }

    input[type="range"]:disabled::-webkit-slider-thumb {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .value-display {
      text-align: center;
      font-size: 1.3rem;
      font-weight: 600;
      margin-top: 4px;
      min-height: 1.8em;
    }

    .value-display.stars {
      color: #ffcc00;
    }

    .value-display.days {
      color: #00ccff;
    }

    .range-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .range-label {
      font-size: 0.85rem;
      color: #a0a0ff;
      min-width: 40px;
    }

    .range-label.min {
      text-align: left;
    }

    .range-label.max {
      text-align: right;
    }

    .range-wrapper {
      flex: 1;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏ */
    .roulette-container {
      position: relative;
      width: 240px;
      height: 240px;
      margin: 0 auto 30px;
    }

    .chance-circle {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, #2a1a4a 0%, #0f0f1a 70%);
      border-radius: 50%;
      border: 8px solid #3a2a5a;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.7), 0 0 40px rgba(120,80,220,0.4);
      overflow: hidden;
    }

    .progress-ring {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: conic-gradient(
        #00ff88 0deg var(--success-deg),
        #ff4444 var(--success-deg) 360deg
      );
      -webkit-mask: radial-gradient(farthest-side, transparent calc(50% - 12px), black calc(50% - 10px));
      mask: radial-gradient(farthest-side, transparent calc(50% - 12px), black calc(50% - 10px));
    }

    /* –í—Ä–∞—â–∞—é—â–∞—è—Å—è —Å—Ç—Ä–µ–ª–∫–∞-—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ */
    .spin-arrow {
      position: absolute;
      top: -12px;
      left: 50%;
      width: 30px;
      height: 60px;
      transform: translateX(-50%) rotate(0deg);
      transform-origin: center 132px;
      z-index: 20;
    }

    .arrow-triangle {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 40px solid #ff3366;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 12px rgba(255, 51, 102, 0.9));
      border-radius: 4px 4px 0 0;
    }

    .arrow-glow {
      position: absolute;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, rgba(255, 51, 102, 0.4), transparent 80%);
      border-radius: 50%;
      top: -5px;
      left: -5px;
    }

    /* –¢–µ–∫—Å—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ */
    .center-text {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      z-index: 5;
    }

    .chance-value {
      font-size: 2.8rem;
      font-weight: 800;
      color: #e0e0ff;
      text-shadow: 0 0 20px currentColor;
      line-height: 1;
    }

    .chance-desc {
      font-size: 1rem;
      color: #a0a0ff;
      margin-top: 8px;
    }

    .spin-button {
      width: 100%;
      padding: 18px;
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff6b6b, #ff8e53);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(255,100,80,0.4);
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-top: 10px;
    }

    .spin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(255,100,80,0.6);
    }

    .spin-button:disabled {
      background: #444;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .topup-button {
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(90deg, #4a9eff, #2a6eff);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(74, 158, 255, 0.3);
      transition: all 0.2s;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .topup-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(74, 158, 255, 0.5);
    }

    .admin-button {
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(90deg, #ff4d94, #ff2a7a);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(255, 77, 148, 0.3);
      transition: all 0.2s;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .admin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(255, 77, 148, 0.5);
    }

    .result {
      margin-top: 24px;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      min-height: 2.2em;
    }

    .win  { color: #00ff88; text-shadow: 0 0 15px #00ff88; }
    .lose { color: #ff5555; text-shadow: 0 0 15px #ff5555; }

    .small-hint {
      text-align: center;
      font-size: 0.85rem;
      color: #8070aa;
      margin-top: 12px;
    }

    .balance-display {
      background: rgba(30, 30, 60, 0.7);
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 20px;
      border: 1px solid #3a3a8a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.1rem;
    }

    .balance-label {
      color: #a0a0ff;
    }

    .balance-value {
      color: #ffcc00;
      font-weight: 700;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ –∫—Ä—É–≥–µ */
    .circle-marks {
      position: absolute;
      inset: 0;
      z-index: 2;
    }

    .mark {
      position: absolute;
      width: 2px;
      height: 16px;
      background: rgba(255, 255, 255, 0.15);
      top: 0;
      left: 50%;
      transform-origin: center 120px;
    }

    .mark.highlight {
      background: rgba(255, 255, 255, 0.4);
      height: 22px;
      width: 3px;
    }

    .topup-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
      background: rgba(20, 20, 40, 0.6);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #3a3a5a;
    }

    .topup-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: rgba(40, 40, 70, 0.5);
      border-radius: 8px;
      border: 1px solid #4a4a8a;
      cursor: pointer;
      transition: all 0.2s;
    }

    .topup-option:hover {
      background: rgba(50, 50, 90, 0.7);
      border-color: #5a5aaa;
      transform: translateY(-2px);
    }

    .topup-option.selected {
      background: rgba(60, 60, 120, 0.8);
      border-color: #6a6aff;
      box-shadow: 0 0 15px rgba(106, 106, 255, 0.3);
    }

    .topup-amount {
      font-weight: 600;
      color: #ffcc00;
      font-size: 1.1rem;
    }

    .topup-price {
      color: #a0a0ff;
      font-size: 0.9rem;
    }

    .topup-confirm-button {
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(90deg, #00cc66, #00aa44);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0, 204, 102, 0.3);
      transition: all 0.2s;
      margin-top: 10px;
    }

    .topup-confirm-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 204, 102, 0.5);
    }

    .topup-confirm-button:disabled {
      background: #444;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .no-balance-warning {
      text-align: center;
      color: #ff6b6b;
      margin-top: 10px;
      font-size: 0.9rem;
      padding: 10px;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(255, 107, 107, 0.3);
    }

    .payment-info {
      text-align: center;
      color: #4a9eff;
      margin-top: 10px;
      font-size: 0.85rem;
      padding: 10px;
      background: rgba(74, 158, 255, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(74, 158, 255, 0.3);
    }

    /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
    .admin-panel {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
      background: rgba(40, 20, 60, 0.7);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #5a3a8a;
    }

    .admin-section-title {
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #ff80ff;
      margin-bottom: 5px;
      padding-bottom: 8px;
      border-bottom: 1px solid #5a3a8a;
    }

    .admin-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .admin-input-group label {
      font-size: 0.9rem;
      color: #c0c0ff;
    }

    .admin-input {
      padding: 10px 12px;
      background: rgba(30, 20, 50, 0.8);
      border: 1px solid #5a4a8a;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
    }

    .admin-input:focus {
      outline: none;
      border-color: #8a6aff;
      box-shadow: 0 0 10px rgba(138, 106, 255, 0.3);
    }

    .admin-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .admin-btn {
      flex: 1;
      padding: 12px;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .admin-btn.add {
      background: linear-gradient(90deg, #00cc66, #00aa44);
      color: white;
    }

    .admin-btn.add:hover {
      background: linear-gradient(90deg, #00dd77, #00bb55);
      transform: translateY(-2px);
    }

    .admin-btn.remove {
      background: linear-gradient(90deg, #ff4d4d, #ff3333);
      color: white;
    }

    .admin-btn.remove:hover {
      background: linear-gradient(90deg, #ff5e5e, #ff4444);
      transform: translateY(-2px);
    }

    .admin-btn.set {
      background: linear-gradient(90deg, #4d94ff, #3377ff);
      color: white;
    }

    .admin-btn.set:hover {
      background: linear-gradient(90deg, #5ea5ff, #4488ff);
      transform: translateY(-2px);
    }

    .admin-users-list {
      max-height: 200px;
      overflow-y: auto;
      background: rgba(30, 20, 50, 0.8);
      border-radius: 8px;
      border: 1px solid #5a4a8a;
      padding: 10px;
      margin-top: 10px;
    }

    .admin-user-item {
      padding: 8px;
      border-bottom: 1px solid #4a3a7a;
      cursor: pointer;
      transition: background 0.2s;
    }

    .admin-user-item:hover {
      background: rgba(80, 60, 120, 0.5);
    }

    .admin-user-item:last-child {
      border-bottom: none;
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-name {
      font-weight: 500;
    }

    .user-balance {
      color: #ffcc00;
      font-weight: 600;
    }

    .admin-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .stat-item {
      background: rgba(30, 20, 50, 0.8);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #5a4a8a;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffcc00;
      margin-top: 5px;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #a0a0ff;
    }

    .admin-warning {
      text-align: center;
      color: #ffcc00;
      font-size: 0.8rem;
      padding: 8px;
      background: rgba(255, 204, 0, 0.1);
      border-radius: 6px;
      border: 1px solid rgba(255, 204, 0, 0.3);
      margin-top: 10px;
    }

    /* –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ */
    .admin-float-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #ff4d94, #ff2a7a);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 77, 148, 0.4);
      z-index: 1000;
      transition: all 0.3s;
    }

    .admin-float-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 77, 148, 0.6);
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">–†–£–õ–ï–¢–ö–ê –ü–†–ï–ú–ò–£–ú–ê 2.0</div>

  <div class="main-content">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="left-panel">
      <div class="balance-display">
        <span class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
        <span class="balance-value" id="balance-value">
          <i class="fas fa-star" style="color: #ffcc00;"></i>
          <span id="balance">0</span> ‚≠ê
        </span>
      </div>

      <div class="control-group">
        <label>–°—Ç–∞–≤–∫–∞ (Telegram Stars):</label>
        <div class="range-container">
          <span class="range-label min">9 ‚≠ê</span>
          <div class="range-wrapper">
            <input type="range" id="stars" min="9" max="999" value="199" step="1"/>
          </div>
          <span class="range-label max">999 ‚≠ê</span>
        </div>
        <div class="value-display stars">
          <span id="stars-value">199</span> ‚≠ê
        </div>
      </div>

      <div class="control-group">
        <label>–ñ–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø—Ä–µ–º–∏—É–º–∞:</label>
        <div class="range-container">
          <span class="range-label min">1 –¥</span>
          <div class="range-wrapper">
            <input type="range" id="days" min="1" max="365" value="30" step="1"/>
          </div>
          <span class="range-label max">365 –¥</span>
        </div>
        <div class="value-display days">
          <span id="days-value">30</span> –¥–Ω–µ–π
        </div>
      </div>

      <button class="spin-button" id="spin-btn">–ü–†–û–ö–†–£–¢–ò–¢–¨ ‚Üí</button>

      <button class="topup-button" id="topup-btn">
        <i class="fas fa-coins"></i>
        –ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°
      </button>

      <div class="small-hint">
        –ß–µ–º –±–æ–ª—å—à–µ —Å—Ç–∞–≤–∫–∞ ‚Äî —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –≤—ã–∏–≥—Ä–∞—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
      </div>

      <!-- –°–∫—Ä—ã—Ç–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
      <div class="topup-options" id="topup-options" style="display: none;">
        <div class="small-hint" style="margin-bottom: 10px;">
          –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
        </div>

        <div class="topup-option" data-amount="49">
          <div>
            <div class="topup-amount">49 ‚≠ê</div>
            <div class="topup-price">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
          </div>
          <i class="fas fa-check" style="color: #00ff88; display: none;"></i>
        </div>

        <div class="topup-option" data-amount="99">
          <div>
            <div class="topup-amount">99 ‚≠ê</div>
            <div class="topup-price">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</div>
          </div>
          <i class="fas fa-check" style="color: #00ff88; display: none;"></i>
        </div>

        <div class="topup-option" data-amount="199">
          <div>
            <div class="topup-amount">199 ‚≠ê</div>
            <div class="topup-price">–í—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</div>
          </div>
          <i class="fas fa-check" style="color: #00ff88; display: none;"></i>
        </div>

        <div class="topup-option" data-amount="499">
          <div>
            <div class="topup-amount">499 ‚≠ê</div>
            <div class="topup-price">–î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</div>
          </div>
          <i class="fas fa-check" style="color: #00ff88; display: none;"></i>
        </div>

        <div class="topup-option" data-amount="999">
          <div>
            <div class="topup-amount">999 ‚≠ê</div>
            <div class="topup-price">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
          </div>
          <i class="fas fa-check" style="color: #00ff88; display: none;"></i>
        </div>

        <button class="topup-confirm-button" id="topup-confirm-btn" disabled>
          <i class="fas fa-shopping-cart"></i>
          –í–´–ë–†–ê–¢–¨ –î–õ–Ø –ü–û–ü–û–õ–ù–ï–ù–ò–Ø
        </button>

        <div class="payment-info">
          <i class="fas fa-info-circle"></i>
          –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ Telegram Stars. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã.
        </div>

        <div class="small-hint" style="margin-top: 10px;">
          –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è: 49 ‚≠ê
        </div>
      </div>

      <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
      <div class="admin-panel" id="admin-panel">
        <div class="admin-section-title">
          <i class="fas fa-crown"></i> –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
        </div>

        <div class="admin-input-group">
          <label for="admin-user-id">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
          <input type="text" id="admin-user-id" class="admin-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789">
        </div>

        <div class="admin-input-group">
          <label for="admin-stars-amount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥:</label>
          <input type="number" id="admin-stars-amount" class="admin-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" max="999999" value="1000">
        </div>

        <div class="admin-buttons">
          <button class="admin-btn add" id="admin-add-btn">
            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
          </button>
          <button class="admin-btn remove" id="admin-remove-btn">
            <i class="fas fa-minus"></i> –°–Ω—è—Ç—å
          </button>
          <button class="admin-btn set" id="admin-set-btn">
            <i class="fas fa-equals"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
          </button>
        </div>

        <div class="admin-stats">
          <div class="stat-item">
            <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            <div class="stat-value" id="total-users">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
            <div class="stat-value" id="total-balance">0 ‚≠ê</div>
          </div>
        </div>

        <div class="admin-input-group">
          <label for="admin-search-user">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
          <input type="text" id="admin-search-user" class="admin-input" placeholder="ID, –∏–º—è –∏–ª–∏ username">
        </div>

        <div class="admin-users-list" id="admin-users-list">
          <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          <div class="admin-user-item" data-user-id="123456789">
            <div class="user-info">
              <div class="user-name">–ê–¥–º–∏–Ω</div>
              <div class="user-balance">‚àû ‚≠ê</div>
            </div>
          </div>
        </div>

        <div class="admin-warning">
          <i class="fas fa-exclamation-triangle"></i>
          –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤! –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.
        </div>
      </div>

      <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –±–∞–ª–∞–Ω—Å–∞ -->
      <div id="no-balance-warning" class="no-balance-warning" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        –£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥ –¥–ª—è —Å—Ç–∞–≤–∫–∏. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî —Ä—É–ª–µ—Ç–∫–∞ -->
    <div class="right-panel">
      <div class="roulette-container">
        <!-- –í—Ä–∞—â–∞—é—â–∞—è—Å—è —Å—Ç—Ä–µ–ª–∫–∞-—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ -->
        <div class="spin-arrow" id="spin-arrow">
          <div class="arrow-glow"></div>
          <div class="arrow-triangle"></div>
        </div>

        <!-- –ö—Ä—É–≥ —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π -->
        <div class="circle-marks" id="circle-marks"></div>

        <!-- –ö—Ä—É–≥ —Ä—É–ª–µ—Ç–∫–∏ -->
        <div class="chance-circle" id="roulette">
          <div class="progress-ring" id="progress"></div>
          <div class="center-text">
            <div class="chance-value" id="chance-value">‚Äî</div>
            <div class="chance-desc">–®–ê–ù–° –í–´–ò–ì–†–ê–¢–¨</div>
          </div>
        </div>
      </div>

      <div class="result" id="result"></div>
    </div>
  </div>
</div>

<!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
<div class="admin-float-btn" id="admin-float-btn" style="display: none;">
  <i class="fas fa-crown"></i>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
const starsSlider = document.getElementById('stars');
const starsDisplay = document.getElementById('stars-value');
const daysSlider = document.getElementById('days');
const daysDisplay = document.getElementById('days-value');
const chanceValue = document.getElementById('chance-value');
const progressRing = document.getElementById('progress');
const spinBtn = document.getElementById('spin-btn');
const resultDiv = document.getElementById('result');
const spinArrow = document.getElementById('spin-arrow');
const circleMarks = document.getElementById('circle-marks');
const balanceValue = document.getElementById('balance');
const topupBtn = document.getElementById('topup-btn');
const topupOptions = document.getElementById('topup-options');
const topupConfirmBtn = document.getElementById('topup-confirm-btn');
const topupOptionElements = document.querySelectorAll('.topup-option');
const noBalanceWarning = document.getElementById('no-balance-warning');
const adminPanel = document.getElementById('admin-panel');
const adminFloatBtn = document.getElementById('admin-float-btn');
const adminUserIdInput = document.getElementById('admin-user-id');
const adminStarsAmountInput = document.getElementById('admin-stars-amount');
const adminAddBtn = document.getElementById('admin-add-btn');
const adminRemoveBtn = document.getElementById('admin-remove-btn');
const adminSetBtn = document.getElementById('admin-set-btn');
const adminSearchInput = document.getElementById('admin-search-user');
const adminUsersList = document.getElementById('admin-users-list');
const totalUsersElement = document.getElementById('total-users');
const totalBalanceElement = document.getElementById('total-balance');

let isSpinning = false;
let animationFrameId = null;
let currentBalance = 0;
let selectedTopupAmount = 0;

// –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
const ADMIN_IDS = [
  123456789, // –ü—Ä–∏–º–µ—Ä ID –∞–¥–º–∏–Ω–∞
  // –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
];

// –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
function checkIfAdmin() {
  const user = tg.initDataUnsafe?.user;
  if (!user) return false;

  const userId = user.id;
  return ADMIN_IDS.includes(userId);
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∞–≤
function setupAdminPanel() {
  const isAdmin = checkIfAdmin();

  if (isAdmin) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞
    adminFloatBtn.style.display = 'flex';

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–ª–∞–≤–∞—é—â–µ–π –∫–Ω–æ–ø–∫–µ
    adminFloatBtn.addEventListener('click', () => {
      const isVisible = adminPanel.style.display === 'block';
      adminPanel.style.display = isVisible ? 'none' : 'block';
      adminFloatBtn.innerHTML = isVisible ? '<i class="fas fa-crown"></i>' : '<i class="fas fa-times"></i>';

      if (!isVisible) {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        loadAdminData();
      }
    });

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    if (tg.initDataUnsafe?.user?.id) {
      adminUserIdInput.value = tg.initDataUnsafe.user.id;
    }

    console.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID:', tg.initDataUnsafe?.user?.id);
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
function loadAdminData() {
  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
  // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  updateAdminStats();

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  loadUserList();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
function updateAdminStats() {
  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
  // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  totalUsersElement.textContent = '127';
  totalBalanceElement.textContent = '45,280 ‚≠ê';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
function loadUserList(searchQuery = '') {
  // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
  adminUsersList.innerHTML = '';

  // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const mockUsers = [
    { id: 123456789, name: '–ê–¥–º–∏–Ω', username: 'admin', balance: 999999 },
    { id: 987654321, name: '–ò–≤–∞–Ω', username: 'ivan123', balance: 1250 },
    { id: 555555555, name: '–ú–∞—Ä–∏—è', username: 'maria_g', balance: 500 },
    { id: 444444444, name: '–ê–ª–µ–∫—Å–µ–π', username: 'alex_tech', balance: 75 },
    { id: 333333333, name: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', username: 'kate_s', balance: 3200 },
  ];

  // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
  const filteredUsers = mockUsers.filter(user => {
    if (!searchQuery) return true;

    const query = searchQuery.toLowerCase();
    return (
      user.id.toString().includes(query) ||
      user.name.toLowerCase().includes(query) ||
      user.username.toLowerCase().includes(query)
    );
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–ø–∏—Å–æ–∫
  filteredUsers.forEach(user => {
    const userItem = document.createElement('div');
    userItem.className = 'admin-user-item';
    userItem.dataset.userId = user.id;

    userItem.innerHTML = `
      <div class="user-info">
        <div class="user-name">
          ${user.name} (@${user.username})
        </div>
        <div class="user-balance">
          ${user.balance.toLocaleString()} ‚≠ê
        </div>
      </div>
    `;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    userItem.addEventListener('click', () => {
      adminUserIdInput.value = user.id;
      adminStarsAmountInput.value = 1000;
    });

    adminUsersList.appendChild(userItem);
  });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã
function sendAdminCommand(action, userId, amount, reason = '') {
  const commandData = {
    action: 'admin_command',
    command: action,
    target_user_id: parseInt(userId),
    amount: parseInt(amount),
    reason: reason,
    admin_id: tg.initDataUnsafe?.user?.id,
    admin_name: tg.initDataUnsafe?.user?.first_name,
    admin_username: tg.initDataUnsafe?.user?.username,
    timestamp: new Date().toISOString()
  };

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É
  tg.sendData(JSON.stringify(commandData));

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  const actionText = action === 'add_stars' ? '–¥–æ–±–∞–≤–ª–µ–Ω—ã' :
                    action === 'remove_stars' ? '—Å–ø–∏—Å–∞–Ω—ã' : '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã';

  tg.showAlert(`–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! ${amount} –∑–≤–µ–∑–¥ –±—É–¥—É—Ç ${actionText} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}.`);

  // –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
  const currentUserId = tg.initDataUnsafe?.user?.id;
  if (parseInt(userId) === currentUserId) {
    if (action === 'add_stars') {
      currentBalance += parseInt(amount);
    } else if (action === 'remove_stars') {
      currentBalance = Math.max(0, currentBalance - parseInt(amount));
    } else if (action === 'set_stars') {
      currentBalance = parseInt(amount);
    }
    updateUI();
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  loadAdminData();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
setupAdminPanel();

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–¥–º–∏–Ω-–∫–Ω–æ–ø–æ–∫
adminAddBtn.addEventListener('click', () => {
  const userId = adminUserIdInput.value.trim();
  const amount = adminStarsAmountInput.value.trim();

  if (!userId || !amount) {
    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
    return;
  }

  sendAdminCommand('add_stars', userId, amount, '–†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
});

adminRemoveBtn.addEventListener('click', () => {
  const userId = adminUserIdInput.value.trim();
  const amount = adminStarsAmountInput.value.trim();

  if (!userId || !amount) {
    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
    return;
  }

  sendAdminCommand('remove_stars', userId, amount, '–†—É—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
});

adminSetBtn.addEventListener('click', () => {
  const userId = adminUserIdInput.value.trim();
  const amount = adminStarsAmountInput.value.trim();

  if (!userId || !amount) {
    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
    return;
  }

  sendAdminCommand('set_stars', userId, amount, '–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
});

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
adminSearchInput.addEventListener('input', (e) => {
  loadUserList(e.target.value);
});

// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏ –Ω–∞ –∫—Ä—É–≥–µ
function createCircleMarks() {
  const marksCount = 36;
  for (let i = 0; i < marksCount; i++) {
    const mark = document.createElement('div');
    mark.className = 'mark';
    if (i % 6 === 0) mark.classList.add('highlight');
    mark.style.transform = `rotate(${i * 10}deg)`;
    circleMarks.appendChild(mark);
  }
}

function calcChance() {
  const stars = Number(starsSlider.value);
  const days = Number(daysSlider.value) || 1;

  const basePrice = 18 + (days > 90 ? 4 : days > 30 ? 2 : 0);
  let chance = (stars / (days * basePrice)) * 100;

  chance = Math.max(3, Math.min(92, Math.round(chance * 10) / 10));

  return chance;
}

function updateUI() {
  const stars = starsSlider.value;
  starsDisplay.textContent = stars;

  const days = daysSlider.value;
  daysDisplay.textContent = days;

  const chance = calcChance();
  chanceValue.textContent = chance.toFixed(1) + "%";

  const deg = (chance / 100) * 360;
  progressRing.style.setProperty('--success-deg', deg + 'deg');

  chanceValue.style.color = chance > 65 ? '#00ffaa' :
                           chance > 35 ? '#ffdd55' : '#ff7777';

  // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
  balanceValue.textContent = currentBalance.toLocaleString();

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –∑–≤–µ–∑–¥ –¥–ª—è —Å—Ç–∞–≤–∫–∏
  const betAmount = Number(stars);
  const canSpin = betAmount <= currentBalance && currentBalance > 0;

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
  if (currentBalance === 0 || betAmount > currentBalance) {
    noBalanceWarning.style.display = 'block';
    spinBtn.disabled = true;
    spinBtn.style.background = 'linear-gradient(90deg, #666, #888)';
  } else {
    noBalanceWarning.style.display = 'none';
    spinBtn.disabled = isSpinning;
    spinBtn.style.background = 'linear-gradient(90deg, #ff6b6b, #ff8e53)';
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–ª–∑—É–Ω–∫–æ–≤
  starsSlider.disabled = isSpinning;
  daysSlider.disabled = isSpinning;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Telegram
function initFromTelegram() {
  const initData = tg.initDataUnsafe;

  // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—É—Å–∫–∞
  if (initData && initData.start_param) {
    try {
      const params = new URLSearchParams(initData.start_param);
      if (params.get('balance')) {
        currentBalance = parseInt(params.get('balance'));
      }
    } catch (e) {
      console.error('Error parsing start params:', e);
    }
  }

  // –ü—Ä–æ–±—É–µ–º –∏–∑ query string
  const urlParams = new URLSearchParams(window.location.search);
  const balanceFromUrl = urlParams.get('balance');
  if (balanceFromUrl) {
    currentBalance = parseInt(balanceFromUrl);
  }

  updateUI();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
topupBtn.addEventListener('click', () => {
  const isVisible = topupOptions.style.display !== 'none';
  if (isVisible) {
    topupOptions.style.display = 'none';
    topupBtn.innerHTML = '<i class="fas fa-coins"></i> –ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°';
  } else {
    topupOptions.style.display = 'block';
    topupBtn.innerHTML = '<i class="fas fa-times"></i> –û–¢–ú–ï–ù–ê –ü–û–ü–û–õ–ù–ï–ù–ò–Ø';
  }
});

topupOptionElements.forEach(option => {
  option.addEventListener('click', () => {
    topupOptionElements.forEach(opt => {
      opt.classList.remove('selected');
      opt.querySelector('i').style.display = 'none';
    });

    option.classList.add('selected');
    option.querySelector('i').style.display = 'block';

    selectedTopupAmount = parseInt(option.dataset.amount);
    topupConfirmBtn.disabled = false;
    topupConfirmBtn.innerHTML = `<i class="fas fa-shopping-cart"></i> –ü–û–ü–û–õ–ù–ò–¢–¨ ${selectedTopupAmount} ‚≠ê`;
  });
});

topupConfirmBtn.addEventListener('click', () => {
  if (selectedTopupAmount >= 49) {
    const paymentData = {
      action: 'request_topup',
      amount: selectedTopupAmount,
      user_id: tg.initDataUnsafe?.user?.id,
      username: tg.initDataUnsafe?.user?.username,
      first_name: tg.initDataUnsafe?.user?.first_name,
      invoice_payload: `topup_${Date.now()}_${selectedTopupAmount}`
    };

    tg.sendData(JSON.stringify(paymentData));

    tg.showAlert(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ${selectedTopupAmount} ‚≠ê –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ë–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã.`);

    topupOptions.style.display = 'none';
    topupBtn.innerHTML = '<i class="fas fa-coins"></i> –ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°';

    topupOptionElements.forEach(opt => {
      opt.classList.remove('selected');
      opt.querySelector('i').style.display = 'none';
    });
    selectedTopupAmount = 0;
    topupConfirmBtn.disabled = true;
    topupConfirmBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> –í–´–ë–†–ê–¢–¨ –î–õ–Ø –ü–û–ü–û–õ–ù–ï–ù–ò–Ø';
  }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
function updateBalance(newBalance) {
  currentBalance = newBalance;
  updateUI();
}

starsSlider.addEventListener('input', updateUI);
daysSlider.addEventListener('input', updateUI);

spinBtn.addEventListener('click', () => {
  if (isSpinning) return;

  const betAmount = Number(starsSlider.value);
  if (betAmount > currentBalance) {
    tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ! –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.");
    return;
  }

  isSpinning = true;

  starsSlider.disabled = true;
  daysSlider.disabled = true;
  spinBtn.disabled = true;

  currentBalance -= betAmount;
  updateUI();

  resultDiv.textContent = '';
  resultDiv.className = 'result';

  const chance = calcChance() / 100;
  const win = Math.random() < chance;

  const extraSpins = 6 + Math.floor(Math.random() * 5);

  let finalAngle;
  if (win) {
    const winAngle = chance * 360;
    finalAngle = 360 * extraSpins + Math.random() * winAngle;
  } else {
    const winAngle = chance * 360;
    finalAngle = 360 * extraSpins + winAngle + Math.random() * (360 - winAngle);
  }

  const duration = 3500 + Math.random() * 1500;
  const startTime = Date.now();

  spinArrow.style.transition = 'none';
  spinArrow.style.transform = 'translateX(-50%) rotate(0deg)';

  function animate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
    const currentAngle = easeOutCubic * finalAngle;

    spinArrow.style.transform = `translateX(-50%) rotate(${currentAngle}deg)`;

    if (progress < 1) {
      animationFrameId = requestAnimationFrame(animate);
    } else {
      animationFrameId = null;

      setTimeout(() => {
        const daysWon = Number(daysSlider.value);

        if (win) {
          resultDiv.textContent = `–£–°–ü–ï–•! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${daysWon} –¥–Ω–µ–π –ü—Ä–µ–º–∏—É–º–∞! üéâ`;
          resultDiv.className = 'result win';

          const winData = {
            action: 'premium_won',
            stars_bet: betAmount,
            days_won: daysWon,
            chance_percent: (chance * 100).toFixed(1),
            user_id: tg.initDataUnsafe?.user?.id,
            username: tg.initDataUnsafe?.user?.username,
            first_name: tg.initDataUnsafe?.user?.first_name,
            timestamp: new Date().toISOString(),
            transaction_id: `win_${Date.now()}_${tg.initDataUnsafe?.user?.id || 'unknown'}`
          };

          tg.sendData(JSON.stringify(winData));

          tg.showAlert(`üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${daysWon} –¥–Ω–µ–π –ü—Ä–µ–º–∏—É–º–∞!`);
        } else {
          resultDiv.textContent = '–ù–µ –ø–æ–≤–µ–∑–ª–æ... –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!';
          resultDiv.className = 'result lose';

          const loseData = {
            action: 'roulette_lose',
            stars_bet: betAmount,
            user_id: tg.initDataUnsafe?.user?.id,
            timestamp: new Date().toISOString()
          };

          tg.sendData(JSON.stringify(loseData));
        }

        spinArrow.style.transition = 'none';
        spinArrow.style.transform = 'translateX(-50%) rotate(0deg)';

        setTimeout(() => {
          isSpinning = false;
          updateUI();
        }, 500);

      }, 500);
    }
  }

  animate();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
createCircleMarks();
initFromTelegram();

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
window.updateBalance = updateBalance;

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –æ—Ç –±–æ—Ç–∞
window.addEventListener('message', (event) => {
  try {
    const data = JSON.parse(event.data);

    if (data.action === 'update_balance') {
      updateBalance(data.balance);
    } else if (data.action === 'topup_success') {
      tg.showAlert(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ ${data.amount} ‚≠ê —É—Å–ø–µ—à–Ω–æ! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${data.new_balance} ‚≠ê`);
      updateBalance(data.new_balance);
    } else if (data.action === 'admin_balance_update') {
      // –ö–æ–º–∞–Ω–¥–∞ –æ—Ç –±–æ—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
      if (checkIfAdmin()) {
        currentBalance = data.new_balance;
        updateUI();
        tg.showAlert(`–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${data.new_balance} ‚≠ê`);
      }
    }
  } catch (e) {
    console.error('Error parsing message:', e);
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tg.onEvent('closing', () => {
  console.log('Web App –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
});
</script>
</body>
</html>
